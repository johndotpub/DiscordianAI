[tox]
envlist = py310,lint,format
isolated_build = true
minversion = 3.24.0

[testenv]
# Base test environment with optimizations
extras = dev
setenv =
    COVERAGE_FILE = {toxworkdir}/.coverage.{envname}
    PYTHONPATH = {toxinidir}/src
deps =
    pytest
    pytest-asyncio
    pytest-xdist[psutil]  # For parallel test execution
    pytest-cov
commands =
    # Run tests in parallel with optimized coverage collection
    pytest {posargs:-n auto --maxfail=3 --tb=short --strict-markers --strict-config}

[testenv:py310]
# Main test environment - inherits from base with coverage
commands =
    pytest {posargs:-n auto --maxfail=3 --tb=short --strict-markers --strict-config --cov=src --cov-report=term-missing:skip-covered --cov-report=xml --cov-fail-under=80}

[testenv:lint]
# Fast linting using pyproject.toml configuration
skip_install = true
deps =
    black
    ruff
commands =
    # Use pyproject.toml configuration (no need for verbose excludes)
    black . --check --diff
    ruff check . --show-fixes --exclude scripts/

[testenv:format]
# Code formatting using pyproject.toml configuration
skip_install = true
deps =
    black
    ruff
commands =
    # Use pyproject.toml configuration
    black . --exclude scripts/
    ruff check . --fix --exclude scripts/



[tox]
envlist = py310,lint,format,test

[testenv]
# Base environment - not used directly, serves as template
deps =
    pytest
    pytest-asyncio
    coverage
    pytest-cov
extras = dev
commands =
    pytest --cov=src --cov-report=term-missing --cov-report=xml --cov-fail-under=80

[testenv:py310]
# Inherit from base testenv
deps = {[testenv]deps}
extras = {[testenv]extras}
commands = {[testenv]commands}

[testenv:lint]
# Check code quality without making changes
deps =
    black
    ruff
commands =
    # Modern Python linting pipeline: black + ruff (exclude scripts folder)
    black . --check --diff --exclude scripts
    ruff check . --show-fixes --exclude scripts

[testenv:format]
# Apply code formatting and fixes
deps =
    black
    ruff
commands =
    # Apply modern formatting and safe fixes (exclude scripts folder)
    black . --exclude scripts
    ruff check . --fix --exclude scripts

[testenv:test]
# Use base testenv configuration for dependencies
deps = {[testenv]deps}
extras = {[testenv]extras}
commands =
    coverage run -m pytest
    coverage report --fail-under=80
    coverage html

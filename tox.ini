[tox]
envlist = py310,lint,test

[testenv]
deps =
    black
    ruff
    pytest
    pytest-asyncio
    coverage
    pytest-cov
extras = dev
commands =
    pytest --cov=src --cov-report=term-missing --cov-fail-under=80

[testenv:py310]
deps =
    pytest
    pytest-asyncio
    coverage
    pytest-cov
extras = dev
commands =
    pytest --cov=src --cov-report=term-missing --cov-fail-under=80

[testenv:lint]
deps =
    black
    ruff
commands =
    # Modern Python linting pipeline: black + ruff
    black . --check --diff
    ruff check . --show-fixes

[testenv:format]
deps =
    black
    ruff
commands =
    # Apply modern formatting and safe fixes
    black .
    ruff check . --fix

[testenv:test]
deps =
    pytest
    pytest-asyncio
    coverage
    pytest-cov
commands =
    coverage run -m pytest
    coverage report --fail-under=80
    coverage html
